rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Rule 1: Allow users to read/write only their own user document
    match /companies/{companyId}/users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Rule 2: Allow only users within the same company to read donor documents
    match /companies/{companyId} {
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/companies/$(companyId)/users/$(request.auth.uid)).exists();
    }
  }
}
